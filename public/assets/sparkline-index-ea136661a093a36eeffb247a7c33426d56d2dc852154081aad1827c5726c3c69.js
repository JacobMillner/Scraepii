/**
*
* jquery.sparkline.js
*
* v2.1.2
* (c) Splunk, Inc
* Contact: Gareth Watts (gareth@splunk.com)
* http://omnipotent.net/jquery.sparkline/
*
* Generates inline sparkline charts from data supplied either to the method
* or inline in HTML
*
* Compatible with Internet Explorer 6.0+ and modern browsers equipped with the canvas tag
* (Firefox 2.0+, Safari, Opera, etc)
*
* License: New BSD License
*
* Copyright (c) 2012, Splunk Inc.
* All rights reserved.
*
* Redistribution and use in source and binary forms, with or without modification,
* are permitted provided that the following conditions are met:
*
*     * Redistributions of source code must retain the above copyright notice,
*       this list of conditions and the following disclaimer.
*     * Redistributions in binary form must reproduce the above copyright notice,
*       this list of conditions and the following disclaimer in the documentation
*       and/or other materials provided with the distribution.
*     * Neither the name of Splunk Inc nor the names of its contributors may
*       be used to endorse or promote products derived from this software without
*       specific prior written permission.
*
* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
* EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
* OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
* SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
* SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT
* OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
* HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
* OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
* SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*
*
* Usage:
*  $(selector).sparkline(values, options)
*
* If values is undefined or set to 'html' then the data values are read from the specified tag:
*   <p>Sparkline: <span class="sparkline">1,4,6,6,8,5,3,5</span></p>
*   $('.sparkline').sparkline();
* There must be no spaces in the enclosed data set
*
* Otherwise values must be an array of numbers or null values
*    <p>Sparkline: <span id="sparkline1">This text replaced if the browser is compatible</span></p>
*    $('#sparkline1').sparkline([1,4,6,6,8,5,3,5])
*    $('#sparkline2').sparkline([1,4,6,null,null,5,3,5])
*
* Values can also be specified in an HTML comment, or as a values attribute:
*    <p>Sparkline: <span class="sparkline"><!--1,4,6,6,8,5,3,5 --></span></p>
*    <p>Sparkline: <span class="sparkline" values="1,4,6,6,8,5,3,5"></span></p>
*    $('.sparkline').sparkline();
*
* For line charts, x values can also be specified:
*   <p>Sparkline: <span class="sparkline">1:1,2.7:4,3.4:6,5:6,6:8,8.7:5,9:3,10:5</span></p>
*    $('#sparkline1').sparkline([ [1,1], [2.7,4], [3.4,6], [5,6], [6,8], [8.7,5], [9,3], [10,5] ])
*
* By default, options should be passed in as teh second argument to the sparkline function:
*   $('.sparkline').sparkline([1,2,3,4], {type: 'bar'})
*
* Options can also be set by passing them on the tag itself.  This feature is disabled by default though
* as there's a slight performance overhead:
*   $('.sparkline').sparkline([1,2,3,4], {enableTagOptions: true})
*   <p>Sparkline: <span class="sparkline" sparkType="bar" sparkBarColor="red">loading</span></p>
* Prefix all options supplied as tag attribute with "spark" (configurable by setting tagOptionPrefix)
*
* Supported options:
*   lineColor - Color of the line used for the chart
*   fillColor - Color used to fill in the chart - Set to '' or false for a transparent chart
*   width - Width of the chart - Defaults to 3 times the number of values in pixels
*   height - Height of the chart - Defaults to the height of the containing element
*   chartRangeMin - Specify the minimum value to use for the Y range of the chart - Defaults to the minimum value supplied
*   chartRangeMax - Specify the maximum value to use for the Y range of the chart - Defaults to the maximum value supplied
*   chartRangeClip - Clip out of range values to the max/min specified by chartRangeMin and chartRangeMax
*   chartRangeMinX - Specify the minimum value to use for the X range of the chart - Defaults to the minimum value supplied
*   chartRangeMaxX - Specify the maximum value to use for the X range of the chart - Defaults to the maximum value supplied
*   composite - If true then don't erase any existing chart attached to the tag, but draw
*           another chart over the top - Note that width and height are ignored if an
*           existing chart is detected.
*   tagValuesAttribute - Name of tag attribute to check for data values - Defaults to 'values'
*   enableTagOptions - Whether to check tags for sparkline options
*   tagOptionPrefix - Prefix used for options supplied as tag attributes - Defaults to 'spark'
*   disableHiddenCheck - If set to true, then the plugin will assume that charts will never be drawn into a
*           hidden dom element, avoding a browser reflow
*   disableInteraction - If set to true then all mouseover/click interaction behaviour will be disabled,
*       making the plugin perform much like it did in 1.x
*   disableTooltips - If set to true then tooltips will be disabled - Defaults to false (tooltips enabled)
*   disableHighlight - If set to true then highlighting of selected chart elements on mouseover will be disabled
*       defaults to false (highlights enabled)
*   highlightLighten - Factor to lighten/darken highlighted chart values by - Defaults to 1.4 for a 40% increase
*   tooltipContainer - Specify which DOM element the tooltip should be rendered into - defaults to document.body
*   tooltipClassname - Optional CSS classname to apply to tooltips - If not specified then a default style will be applied
*   tooltipOffsetX - How many pixels away from the mouse pointer to render the tooltip on the X axis
*   tooltipOffsetY - How many pixels away from the mouse pointer to render the tooltip on the r axis
*   tooltipFormatter  - Optional callback that allows you to override the HTML displayed in the tooltip
*       callback is given arguments of (sparkline, options, fields)
*   tooltipChartTitle - If specified then the tooltip uses the string specified by this setting as a title
*   tooltipFormat - A format string or SPFormat object  (or an array thereof for multiple entries)
*       to control the format of the tooltip
*   tooltipPrefix - A string to prepend to each field displayed in a tooltip
*   tooltipSuffix - A string to append to each field displayed in a tooltip
*   tooltipSkipNull - If true then null values will not have a tooltip displayed (defaults to true)
*   tooltipValueLookups - An object or range map to map field values to tooltip strings
*       (eg. to map -1 to "Lost", 0 to "Draw", and 1 to "Win")
*   numberFormatter - Optional callback for formatting numbers in tooltips
*   numberDigitGroupSep - Character to use for group separator in numbers "1,234" - Defaults to ","
*   numberDecimalMark - Character to use for the decimal point when formatting numbers - Defaults to "."
*   numberDigitGroupCount - Number of digits between group separator - Defaults to 3
*
* There are 7 types of sparkline, selected by supplying a "type" option of 'line' (default),
* 'bar', 'tristate', 'bullet', 'discrete', 'pie' or 'box'
*    line - Line chart.  Options:
*       spotColor - Set to '' to not end each line in a circular spot
*       minSpotColor - If set, color of spot at minimum value
*       maxSpotColor - If set, color of spot at maximum value
*       spotRadius - Radius in pixels
*       lineWidth - Width of line in pixels
*       normalRangeMin
*       normalRangeMax - If set draws a filled horizontal bar between these two values marking the "normal"
*                      or expected range of values
*       normalRangeColor - Color to use for the above bar
*       drawNormalOnTop - Draw the normal range above the chart fill color if true
*       defaultPixelsPerValue - Defaults to 3 pixels of width for each value in the chart
*       highlightSpotColor - The color to use for drawing a highlight spot on mouseover - Set to null to disable
*       highlightLineColor - The color to use for drawing a highlight line on mouseover - Set to null to disable
*       valueSpots - Specify which points to draw spots on, and in which color.  Accepts a range map
*
*   bar - Bar chart.  Options:
*       barColor - Color of bars for postive values
*       negBarColor - Color of bars for negative values
*       zeroColor - Color of bars with zero values
*       nullColor - Color of bars with null values - Defaults to omitting the bar entirely
*       barWidth - Width of bars in pixels
*       colorMap - Optional mappnig of values to colors to override the *BarColor values above
*                  can be an Array of values to control the color of individual bars or a range map
*                  to specify colors for individual ranges of values
*       barSpacing - Gap between bars in pixels
*       zeroAxis - Centers the y-axis around zero if true
*
*   tristate - Charts values of win (>0), lose (<0) or draw (=0)
*       posBarColor - Color of win values
*       negBarColor - Color of lose values
*       zeroBarColor - Color of draw values
*       barWidth - Width of bars in pixels
*       barSpacing - Gap between bars in pixels
*       colorMap - Optional mappnig of values to colors to override the *BarColor values above
*                  can be an Array of values to control the color of individual bars or a range map
*                  to specify colors for individual ranges of values
*
*   discrete - Options:
*       lineHeight - Height of each line in pixels - Defaults to 30% of the graph height
*       thesholdValue - Values less than this value will be drawn using thresholdColor instead of lineColor
*       thresholdColor
*
*   bullet - Values for bullet graphs msut be in the order: target, performance, range1, range2, range3, ...
*       options:
*       targetColor - The color of the vertical target marker
*       targetWidth - The width of the target marker in pixels
*       performanceColor - The color of the performance measure horizontal bar
*       rangeColors - Colors to use for each qualitative range background color
*
*   pie - Pie chart. Options:
*       sliceColors - An array of colors to use for pie slices
*       offset - Angle in degrees to offset the first slice - Try -90 or +90
*       borderWidth - Width of border to draw around the pie chart, in pixels - Defaults to 0 (no border)
*       borderColor - Color to use for the pie chart border - Defaults to #000
*
*   box - Box plot. Options:
*       raw - Set to true to supply pre-computed plot points as values
*             values should be: low_outlier, low_whisker, q1, median, q3, high_whisker, high_outlier
*             When set to false you can supply any number of values and the box plot will
*             be computed for you.  Default is false.
*       showOutliers - Set to true (default) to display outliers as circles
*       outlierIQR - Interquartile range used to determine outliers.  Default 1.5
*       boxLineColor - Outline color of the box
*       boxFillColor - Fill color for the box
*       whiskerColor - Line color used for whiskers
*       outlierLineColor - Outline color of outlier circles
*       outlierFillColor - Fill color of the outlier circles
*       spotRadius - Radius of outlier circles
*       medianColor - Line color of the median line
*       target - Draw a target cross hair at the supplied value (default undefined)
*
*
*
*   Examples:
*   $('#sparkline1').sparkline(myvalues, { lineColor: '#f00', fillColor: false });
*   $('.barsparks').sparkline('html', { type:'bar', height:'40px', barWidth:5 });
*   $('#tristate').sparkline([1,1,-1,1,0,0,-1], { type:'tristate' }):
*   $('#discrete').sparkline([1,3,4,5,5,3,4,5], { type:'discrete' });
*   $('#bullet').sparkline([10,12,12,9,7], { type:'bullet' });
*   $('#pie').sparkline([1,1,2], { type:'pie' });
*/
!function(t,e,i){!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):jQuery&&!jQuery.fn.sparkline&&t(jQuery)}(function(n){"use strict";var s,o,r,a,l,h,c,u,d,p,f,g,m,v,y,b,x,w,_,k,C,T,S,D,A,E,I,P,M,N,L,O,H={},R=0;s=function(){return{common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:i,normalRangeMax:i,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:i,chartRangeMax:i,chartRangeMinX:i,chartRangeMaxX:i,tooltipFormat:new r('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:i,nullColor:i,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:i,chartRangeMin:i,chartRangeClip:!1,colorMap:i,tooltipFormat:new r('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new r('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss",0:"Draw",1:"Win"}}},discrete:{lineHeight:"auto",thresholdColor:i,thresholdValue:0,chartRangeMax:i,chartRangeMin:i,chartRangeClip:!1,tooltipFormat:new r("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:i,tooltipFormat:new r("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],borderWidth:0,borderColor:"#000",tooltipFormat:new r('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:i,targetColor:"#4a2",chartRangeMax:i,chartRangeMin:i,tooltipFormat:new r("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}}},E='.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}',o=function(){var t,e;return t=function(){this.init.apply(this,arguments)},arguments.length>1?(arguments[0]?(t.prototype=n.extend(new arguments[0],arguments[arguments.length-1]),t._super=arguments[0].prototype):t.prototype=arguments[arguments.length-1],arguments.length>2&&(e=Array.prototype.slice.call(arguments,1,-1),e.unshift(t.prototype),n.extend.apply(n,e))):t.prototype=arguments[0],t.prototype.cls=t,t},n.SPFormatClass=r=o({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(t,e){this.format=t,this.fclass=e},render:function(t,e,n){var s,o,r,a,l,h=this,c=t;return this.format.replace(this.fre,function(){var t;return o=arguments[1],r=arguments[3],s=h.precre.exec(o),s?(l=s[2],o=s[1]):l=!1,a=c[o],a===i?"":r&&e&&e[r]?(t=e[r],t.get?e[r].get(a)||a:e[r][a]||a):(d(a)&&(a=n.get("numberFormatter")?n.get("numberFormatter")(a):v(a,l,n.get("numberDigitGroupCount"),n.get("numberDigitGroupSep"),n.get("numberDecimalMark"))),a)})}}),n.spformat=function(t,e){return new r(t,e)},a=function(t,e,i){return e>t?e:t>i?i:t},l=function(t,i){var n;return 2===i?(n=e.floor(t.length/2),t.length%2?t[n]:(t[n-1]+t[n])/2):t.length%2?(n=(t.length*i+i)/4,n%1?(t[e.floor(n)]+t[e.floor(n)-1])/2:t[n-1]):(n=(t.length*i+2)/4,n%1?(t[e.floor(n)]+t[e.floor(n)-1])/2:t[n-1])},h=function(t){var e;switch(t){case"undefined":t=i;break;case"null":t=null;break;case"true":t=!0;break;case"false":t=!1;break;default:e=parseFloat(t),t==e&&(t=e)}return t},c=function(t){var e,i=[];for(e=t.length;e--;)i[e]=h(t[e]);return i},u=function(t,e){var i,n,s=[];for(i=0,n=t.length;n>i;i++)t[i]!==e&&s.push(t[i]);return s},d=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},v=function(t,e,i,s,o){var r,a;for(t=(e===!1?parseFloat(t).toString():t.toFixed(e)).split(""),r=(r=n.inArray(".",t))<0?t.length:r,r<t.length&&(t[r]=o),a=r-i;a>0;a-=i)t.splice(a,0,s);return t.join("")},p=function(t,e,i){var n;for(n=e.length;n--;)if((!i||null!==e[n])&&e[n]!==t)return!1;return!0},f=function(t){var e,i=0;for(e=t.length;e--;)i+="number"==typeof t[e]?t[e]:0;return i},m=function(t){return n.isArray(t)?t:[t]},g=function(e){var i;t.createStyleSheet?t.createStyleSheet().cssText=e:(i=t.createElement("style"),i.type="text/css",t.getElementsByTagName("head")[0].appendChild(i),i["string"==typeof t.body.style.WebkitAppearance?"innerText":"innerHTML"]=e)},n.fn.simpledraw=function(e,s,o,r){var a,l;if(o&&(a=this.data("_jqs_vcanvas")))return a;if(n.fn.sparkline.canvas===!1)return!1;if(n.fn.sparkline.canvas===i){var h=t.createElement("canvas");if(h.getContext&&h.getContext("2d"))n.fn.sparkline.canvas=function(t,e,i,n){return new N(t,e,i,n)};else{if(!t.namespaces||t.namespaces.v)return n.fn.sparkline.canvas=!1,!1;t.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),n.fn.sparkline.canvas=function(t,e,i){return new L(t,e,i)}}}return e===i&&(e=n(this).innerWidth()),s===i&&(s=n(this).innerHeight()),a=n.fn.sparkline.canvas(e,s,this,r),l=n(this).data("_jqs_mhandler"),l&&l.registerCanvas(a),a},n.fn.cleardraw=function(){var t=this.data("_jqs_vcanvas");t&&t.reset()},n.RangeMapClass=y=o({init:function(t){var e,i,n=[];for(e in t)t.hasOwnProperty(e)&&"string"==typeof e&&e.indexOf(":")>-1&&(i=e.split(":"),i[0]=0===i[0].length?-(1/0):parseFloat(i[0]),i[1]=0===i[1].length?1/0:parseFloat(i[1]),i[2]=t[e],n.push(i));this.map=t,this.rangelist=n||!1},get:function(t){var e,n,s,o=this.rangelist;if((s=this.map[t])!==i)return s;if(o)for(e=o.length;e--;)if(n=o[e],n[0]<=t&&n[1]>=t)return n[2];return i}}),n.range_map=function(t){return new y(t)},b=o({init:function(t,e){var i=n(t);this.$el=i,this.options=e,this.currentPageX=0,this.currentPageY=0,this.el=t,this.splist=[],this.tooltip=null,this.over=!1,this.displayTooltips=!e.get("disableTooltips"),this.highlightEnabled=!e.get("disableHighlight")},registerSparkline:function(t){this.splist.push(t),this.over&&this.updateDisplay()},registerCanvas:function(t){var e=n(t.canvas);this.canvas=t,this.$canvas=e,e.mouseenter(n.proxy(this.mouseenter,this)),e.mouseleave(n.proxy(this.mouseleave,this)),e.click(n.proxy(this.mouseclick,this))},reset:function(t){this.splist=[],this.tooltip&&t&&(this.tooltip.remove(),this.tooltip=i)},mouseclick:function(t){var e=n.Event("sparklineClick");e.originalEvent=t,e.sparklines=this.splist,this.$el.trigger(e)},mouseenter:function(e){n(t.body).unbind("mousemove.jqs"),n(t.body).bind("mousemove.jqs",n.proxy(this.mousemove,this)),this.over=!0,this.currentPageX=e.pageX,this.currentPageY=e.pageY,this.currentEl=e.target,!this.tooltip&&this.displayTooltips&&(this.tooltip=new x(this.options),this.tooltip.updatePosition(e.pageX,e.pageY)),this.updateDisplay()},mouseleave:function(){n(t.body).unbind("mousemove.jqs");var e,i,s=this.splist,o=s.length,r=!1;for(this.over=!1,this.currentEl=null,this.tooltip&&(this.tooltip.remove(),this.tooltip=null),i=0;o>i;i++)e=s[i],e.clearRegionHighlight()&&(r=!0);r&&this.canvas.render()},mousemove:function(t){this.currentPageX=t.pageX,this.currentPageY=t.pageY,this.currentEl=t.target,this.tooltip&&this.tooltip.updatePosition(t.pageX,t.pageY),this.updateDisplay()},updateDisplay:function(){var t,e,i,s,o,r=this.splist,a=r.length,l=!1,h=this.$canvas.offset(),c=this.currentPageX-h.left,u=this.currentPageY-h.top;if(this.over){for(i=0;a>i;i++)e=r[i],s=e.setRegionHighlight(this.currentEl,c,u),s&&(l=!0);if(l){if(o=n.Event("sparklineRegionChange"),o.sparklines=this.splist,this.$el.trigger(o),this.tooltip){for(t="",i=0;a>i;i++)e=r[i],t+=e.getCurrentRegionTooltip();this.tooltip.setContent(t)}this.disableHighlight||this.canvas.render()}null===s&&this.mouseleave()}}}),x=o({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(e){var i,s=e.get("tooltipClassname","jqstooltip"),o=this.sizeStyle;this.container=e.get("tooltipContainer")||t.body,this.tooltipOffsetX=e.get("tooltipOffsetX",10),this.tooltipOffsetY=e.get("tooltipOffsetY",12),n("#jqssizetip").remove(),n("#jqstooltip").remove(),this.sizetip=n("<div/>",{id:"jqssizetip",style:o,"class":s}),this.tooltip=n("<div/>",{id:"jqstooltip","class":s}).appendTo(this.container),i=this.tooltip.offset(),this.offsetLeft=i.left,this.offsetTop=i.top,this.hidden=!0,n(window).unbind("resize.jqs scroll.jqs"),n(window).bind("resize.jqs scroll.jqs",n.proxy(this.updateWindowDims,this)),this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=n(window).scrollTop(),this.scrollLeft=n(window).scrollLeft(),this.scrollRight=this.scrollLeft+n(window).width(),this.updatePosition()},getSize:function(t){this.sizetip.html(t).appendTo(this.container),this.width=this.sizetip.width()+1,this.height=this.sizetip.height(),this.sizetip.remove()},setContent:function(t){return t?(this.getSize(t),this.tooltip.html(t).css({width:this.width,height:this.height,visibility:"visible"}),void(this.hidden&&(this.hidden=!1,this.updatePosition()))):(this.tooltip.css("visibility","hidden"),void(this.hidden=!0))},updatePosition:function(t,e){if(t===i){if(this.mousex===i)return;t=this.mousex-this.offsetLeft,e=this.mousey-this.offsetTop}else this.mousex=t-=this.offsetLeft,this.mousey=e-=this.offsetTop;this.height&&this.width&&!this.hidden&&(e-=this.height+this.tooltipOffsetY,t+=this.tooltipOffsetX,e<this.scrollTop&&(e=this.scrollTop),t<this.scrollLeft?t=this.scrollLeft:t+this.width>this.scrollRight&&(t=this.scrollRight-this.width),this.tooltip.css({left:t,top:e}))},remove:function(){this.tooltip.remove(),this.sizetip.remove(),this.sizetip=this.tooltip=i,n(window).unbind("resize.jqs scroll.jqs")}}),I=function(){g(E)},n(I),O=[],n.fn.sparkline=function(e,s){return this.each(function(){var o,r,a=new n.fn.sparkline.options(this,s),l=n(this);if(o=function(){var s,o,r,h,c,u,d;return"html"===e||e===i?(d=this.getAttribute(a.get("tagValuesAttribute")),d!==i&&null!==d||(d=l.html()),s=d.replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(",")):s=e,o="auto"===a.get("width")?s.length*a.get("defaultPixelsPerValue"):a.get("width"),"auto"===a.get("height")?a.get("composite")&&n.data(this,"_jqs_vcanvas")||(h=t.createElement("span"),h.innerHTML="a",l.html(h),r=n(h).innerHeight()||n(h).height(),n(h).remove(),h=null):r=a.get("height"),a.get("disableInteraction")?c=!1:(c=n.data(this,"_jqs_mhandler"),c?a.get("composite")||c.reset():(c=new b(this,a),n.data(this,"_jqs_mhandler",c))),a.get("composite")&&!n.data(this,"_jqs_vcanvas")?void(n.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),n.data(this,"_jqs_errnotify",!0))):(u=new(n.fn.sparkline[a.get("type")])(this,s,a,o,r),u.render(),void(c&&c.registerSparkline(u)))},n(this).html()&&!a.get("disableHiddenCheck")&&n(this).is(":hidden")||!n(this).parents("body").length){if(!a.get("composite")&&n.data(this,"_jqs_pending"))for(r=O.length;r;r--)O[r-1][0]==this&&O.splice(r-1,1);O.push([this,o]),n.data(this,"_jqs_pending",!0)}else o.call(this)})},n.fn.sparkline.defaults=s(),n.sparkline_display_visible=function(){var t,e,i,s=[];for(e=0,i=O.length;i>e;e++)t=O[e][0],n(t).is(":visible")&&!n(t).parents().is(":hidden")?(O[e][1].call(t),n.data(O[e][0],"_jqs_pending",!1),s.push(e)):n(t).closest("html").length||n.data(t,"_jqs_pending")||(n.data(O[e][0],"_jqs_pending",!1),s.push(e));for(e=s.length;e;e--)O.splice(s[e-1],1)},n.fn.sparkline.options=o({init:function(t,e){var i,s,o,r;this.userOptions=e=e||{},this.tag=t,this.tagValCache={},s=n.fn.sparkline.defaults,o=s.common,this.tagOptionsPrefix=e.enableTagOptions&&(e.tagOptionsPrefix||o.tagOptionsPrefix),r=this.getTagSetting("type"),i=r===H?s[e.type||o.type]:s[r],this.mergedOptions=n.extend({},o,i,e)},getTagSetting:function(t){var e,n,s,o,r=this.tagOptionsPrefix;if(r===!1||r===i)return H;if(this.tagValCache.hasOwnProperty(t))e=this.tagValCache.key;else{if(e=this.tag.getAttribute(r+t),e===i||null===e)e=H;else if("["===e.substr(0,1))for(e=e.substr(1,e.length-2).split(","),n=e.length;n--;)e[n]=h(e[n].replace(/(^\s*)|(\s*$)/g,""));else if("{"===e.substr(0,1))for(s=e.substr(1,e.length-2).split(","),e={},n=s.length;n--;)o=s[n].split(":",2),e[o[0].replace(/(^\s*)|(\s*$)/g,"")]=h(o[1].replace(/(^\s*)|(\s*$)/g,""));else e=h(e);this.tagValCache.key=e}return e},get:function(t,e){var n,s=this.getTagSetting(t);return s!==H?s:(n=this.mergedOptions[t])===i?e:n}}),n.fn.sparkline._base=o({disabled:!1,init:function(t,e,s,o,r){this.el=t,this.$el=n(t),this.values=e,this.options=s,this.width=o,this.height=r,this.currentRegion=i},initTarget:function(){var t=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),t))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return this.disabled?(this.el.innerHTML="",!1):!0},getRegion:function(){},setRegionHighlight:function(t,e,n){var s,o=this.currentRegion,r=!this.options.get("disableHighlight");return e>this.canvasWidth||n>this.canvasHeight||0>e||0>n?null:(s=this.getRegion(t,e,n),o!==s?(o!==i&&r&&this.removeHighlight(),this.currentRegion=s,s!==i&&r&&this.renderHighlight(),!0):!1)},clearRegionHighlight:function(){return this.currentRegion!==i?(this.removeHighlight(),this.currentRegion=i,!0):!1},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(){},getCurrentRegionTooltip:function(){var t,e,s,o,a,l,h,c,u,d,p,f,g,m,v=this.options,y="",b=[];if(this.currentRegion===i)return"";if(t=this.getCurrentRegionFields(),p=v.get("tooltipFormatter"))return p(this,v,t);if(v.get("tooltipChartTitle")&&(y+='<div class="jqs jqstitle">'+v.get("tooltipChartTitle")+"</div>\n"),e=this.options.get("tooltipFormat"),!e)return"";if(n.isArray(e)||(e=[e]),n.isArray(t)||(t=[t]),h=this.options.get("tooltipFormatFieldlist"),c=this.options.get("tooltipFormatFieldlistKey"),h&&c){for(u=[],l=t.length;l--;)d=t[l][c],-1!=(m=n.inArray(d,h))&&(u[m]=t[l]);t=u}for(s=e.length,g=t.length,l=0;s>l;l++)for(f=e[l],"string"==typeof f&&(f=new r(f)),o=f.fclass||"jqsfield",m=0;g>m;m++)t[m].isNull&&v.get("tooltipSkipNull")||(n.extend(t[m],{prefix:v.get("tooltipPrefix"),suffix:v.get("tooltipSuffix")}),a=f.render(t[m],v.get("tooltipValueLookups"),v),b.push('<div class="'+o+'">'+a+"</div>"));return b.length?y+b.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(t,i){var n,s,o,r,l=i.get("highlightColor"),h=i.get("highlightLighten");if(l)return l;if(h&&(n=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(t))){for(o=[],s=4===t.length?16:1,r=0;3>r;r++)o[r]=a(e.round(parseInt(n[r+1],16)*s*h),0,255);return"rgb("+o.join(",")+")"}return t}}),w={changeHighlight:function(t){var e,i=this.currentRegion,s=this.target,o=this.regionShapes[i];o&&(e=this.renderRegion(i,t),n.isArray(e)||n.isArray(o)?(s.replaceWithShapes(o,e),this.regionShapes[i]=n.map(e,function(t){return t.id})):(s.replaceWithShape(o,e),this.regionShapes[i]=e.id))},render:function(){var t,e,i,s,o=this.values,r=this.target,a=this.regionShapes;if(this.cls._super.render.call(this)){for(i=o.length;i--;)if(t=this.renderRegion(i))if(n.isArray(t)){for(e=[],s=t.length;s--;)t[s].append(),e.push(t[s].id);a[i]=e}else t.append(),a[i]=t.id;else a[i]=null;r.render()}}},n.fn.sparkline.line=_=o(n.fn.sparkline._base,{type:"line",init:function(t,e,i,n,s){_._super.init.call(this,t,e,i,n,s),this.vertices=[],this.regionMap=[],this.xvalues=[],this.yvalues=[],this.yminmax=[],this.hightlightSpotId=null,this.lastShapeId=null,this.initTarget()},getRegion:function(t,e){var n,s=this.regionMap;for(n=s.length;n--;)if(null!==s[n]&&e>=s[n][0]&&e<=s[n][1])return s[n][2];return i},getCurrentRegionFields:function(){var t=this.currentRegion;return{isNull:null===this.yvalues[t],x:this.xvalues[t],y:this.yvalues[t],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:t}},renderHighlight:function(){var t,e,n=this.currentRegion,s=this.target,o=this.vertices[n],r=this.options,a=r.get("spotRadius"),l=r.get("highlightSpotColor"),h=r.get("highlightLineColor");o&&(a&&l&&(t=s.drawCircle(o[0],o[1],a,i,l),this.highlightSpotId=t.id,s.insertAfterShape(this.lastShapeId,t)),h&&(e=s.drawLine(o[0],this.canvasTop,o[0],this.canvasTop+this.canvasHeight,h),this.highlightLineId=e.id,s.insertAfterShape(this.lastShapeId,e)))},removeHighlight:function(){var t=this.target;this.highlightSpotId&&(t.removeShapeId(this.highlightSpotId),this.highlightSpotId=null),this.highlightLineId&&(t.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){var t,i,n,s,o,r=this.values,a=r.length,l=this.xvalues,h=this.yvalues,c=this.yminmax;for(t=0;a>t;t++)i=r[t],n="string"==typeof r[t],s="object"==typeof r[t]&&r[t]instanceof Array,o=n&&r[t].split(":"),n&&2===o.length?(l.push(Number(o[0])),h.push(Number(o[1])),c.push(Number(o[1]))):s?(l.push(i[0]),h.push(i[1]),c.push(i[1])):(l.push(t),null===r[t]||"null"===r[t]?h.push(null):(h.push(Number(i)),c.push(Number(i))));this.options.get("xvalues")&&(l=this.options.get("xvalues")),this.maxy=this.maxyorg=e.max.apply(e,c),this.miny=this.minyorg=e.min.apply(e,c),this.maxx=e.max.apply(e,l),this.minx=e.min.apply(e,l),this.xvalues=l,this.yvalues=h,this.yminmax=c},processRangeOptions:function(){var t=this.options,e=t.get("normalRangeMin"),n=t.get("normalRangeMax");e!==i&&(e<this.miny&&(this.miny=e),n>this.maxy&&(this.maxy=n)),t.get("chartRangeMin")!==i&&(t.get("chartRangeClip")||t.get("chartRangeMin")<this.miny)&&(this.miny=t.get("chartRangeMin")),t.get("chartRangeMax")!==i&&(t.get("chartRangeClip")||t.get("chartRangeMax")>this.maxy)&&(this.maxy=t.get("chartRangeMax")),t.get("chartRangeMinX")!==i&&(t.get("chartRangeClipX")||t.get("chartRangeMinX")<this.minx)&&(this.minx=t.get("chartRangeMinX")),t.get("chartRangeMaxX")!==i&&(t.get("chartRangeClipX")||t.get("chartRangeMaxX")>this.maxx)&&(this.maxx=t.get("chartRangeMaxX"))},drawNormalRange:function(t,n,s,o,r){var a=this.options.get("normalRangeMin"),l=this.options.get("normalRangeMax"),h=n+e.round(s-s*((l-this.miny)/r)),c=e.round(s*(l-a)/r);this.target.drawRect(t,h,o,c,i,this.options.get("normalRangeColor")).append()},render:function(){var t,s,o,r,a,l,h,c,u,d,p,f,g,m,v,b,x,w,k,C,T,S,D,A,E,I=this.options,P=this.target,M=this.canvasWidth,N=this.canvasHeight,L=this.vertices,O=I.get("spotRadius"),H=this.regionMap;if(_._super.render.call(this)&&(this.scanValues(),this.processRangeOptions(),D=this.xvalues,A=this.yvalues,this.yminmax.length&&!(this.yvalues.length<2))){for(r=a=0,t=this.maxx-this.minx===0?1:this.maxx-this.minx,s=this.maxy-this.miny===0?1:this.maxy-this.miny,o=this.yvalues.length-1,O&&(4*O>M||4*O>N)&&(O=0),O&&(T=I.get("highlightSpotColor")&&!I.get("disableInteraction"),(T||I.get("minSpotColor")||I.get("spotColor")&&A[o]===this.miny)&&(N-=e.ceil(O)),(T||I.get("maxSpotColor")||I.get("spotColor")&&A[o]===this.maxy)&&(N-=e.ceil(O),r+=e.ceil(O)),(T||(I.get("minSpotColor")||I.get("maxSpotColor"))&&(A[0]===this.miny||A[0]===this.maxy))&&(a+=e.ceil(O),M-=e.ceil(O)),(T||I.get("spotColor")||I.get("minSpotColor")||I.get("maxSpotColor")&&(A[o]===this.miny||A[o]===this.maxy))&&(M-=e.ceil(O))),N--,I.get("normalRangeMin")===i||I.get("drawNormalOnTop")||this.drawNormalRange(a,r,N,M,s),h=[],c=[h],m=v=null,b=A.length,E=0;b>E;E++)u=D[E],p=D[E+1],d=A[E],f=a+e.round((u-this.minx)*(M/t)),g=b-1>E?a+e.round((p-this.minx)*(M/t)):M,v=f+(g-f)/2,H[E]=[m||0,v,E],m=v,null===d?E&&(null!==A[E-1]&&(h=[],c.push(h)),L.push(null)):(d<this.miny&&(d=this.miny),d>this.maxy&&(d=this.maxy),h.length||h.push([f,r+N]),l=[f,r+e.round(N-N*((d-this.miny)/s))],h.push(l),L.push(l));for(x=[],w=[],k=c.length,E=0;k>E;E++)h=c[E],h.length&&(I.get("fillColor")&&(h.push([h[h.length-1][0],r+N]),w.push(h.slice(0)),h.pop()),h.length>2&&(h[0]=[h[0][0],h[1][1]]),x.push(h));for(k=w.length,E=0;k>E;E++)P.drawShape(w[E],I.get("fillColor"),I.get("fillColor")).append();for(I.get("normalRangeMin")!==i&&I.get("drawNormalOnTop")&&this.drawNormalRange(a,r,N,M,s),k=x.length,E=0;k>E;E++)P.drawShape(x[E],I.get("lineColor"),i,I.get("lineWidth")).append();if(O&&I.get("valueSpots"))for(C=I.get("valueSpots"),C.get===i&&(C=new y(C)),E=0;b>E;E++)S=C.get(A[E]),S&&P.drawCircle(a+e.round((D[E]-this.minx)*(M/t)),r+e.round(N-N*((A[E]-this.miny)/s)),O,i,S).append();O&&I.get("spotColor")&&null!==A[o]&&P.drawCircle(a+e.round((D[D.length-1]-this.minx)*(M/t)),r+e.round(N-N*((A[o]-this.miny)/s)),O,i,I.get("spotColor")).append(),this.maxy!==this.minyorg&&(O&&I.get("minSpotColor")&&(u=D[n.inArray(this.minyorg,A)],P.drawCircle(a+e.round((u-this.minx)*(M/t)),r+e.round(N-N*((this.minyorg-this.miny)/s)),O,i,I.get("minSpotColor")).append()),O&&I.get("maxSpotColor")&&(u=D[n.inArray(this.maxyorg,A)],P.drawCircle(a+e.round((u-this.minx)*(M/t)),r+e.round(N-N*((this.maxyorg-this.miny)/s)),O,i,I.get("maxSpotColor")).append())),this.lastShapeId=P.getLastShapeId(),this.canvasTop=r,P.render()}}}),n.fn.sparkline.bar=k=o(n.fn.sparkline._base,w,{type:"bar",init:function(t,s,o,r,l){var d,p,f,g,m,v,b,x,w,_,C,T,S,D,A,E,I,P,M,N,L,O,H=parseInt(o.get("barWidth"),10),R=parseInt(o.get("barSpacing"),10),z=o.get("chartRangeMin"),W=o.get("chartRangeMax"),F=o.get("chartRangeClip"),j=1/0,$=-(1/0);for(k._super.init.call(this,t,s,o,r,l),v=0,b=s.length;b>v;v++)N=s[v],d="string"==typeof N&&N.indexOf(":")>-1,(d||n.isArray(N))&&(A=!0,d&&(N=s[v]=c(N.split(":"))),N=u(N,null),p=e.min.apply(e,N),f=e.max.apply(e,N),j>p&&(j=p),f>$&&($=f));this.stacked=A,this.regionShapes={},this.barWidth=H,this.barSpacing=R,this.totalBarWidth=H+R,this.width=r=s.length*H+(s.length-1)*R,this.initTarget(),F&&(S=z===i?-(1/0):z,D=W===i?1/0:W),m=[],g=A?[]:m;var B=[],q=[];for(v=0,b=s.length;b>v;v++)if(A)for(E=s[v],s[v]=M=[],B[v]=0,g[v]=q[v]=0,I=0,P=E.length;P>I;I++)N=M[I]=F?a(E[I],S,D):E[I],null!==N&&(N>0&&(B[v]+=N),0>j&&$>0?0>N?q[v]+=e.abs(N):g[v]+=N:g[v]+=e.abs(N-(0>N?$:j)),m.push(N));else N=F?a(s[v],S,D):s[v],N=s[v]=h(N),null!==N&&m.push(N);this.max=T=e.max.apply(e,m),this.min=C=e.min.apply(e,m),this.stackMax=$=A?e.max.apply(e,B):T,this.stackMin=j=A?e.min.apply(e,m):C,o.get("chartRangeMin")!==i&&(o.get("chartRangeClip")||o.get("chartRangeMin")<C)&&(C=o.get("chartRangeMin")),o.get("chartRangeMax")!==i&&(o.get("chartRangeClip")||o.get("chartRangeMax")>T)&&(T=o.get("chartRangeMax")),this.zeroAxis=w=o.get("zeroAxis",!0),_=0>=C&&T>=0&&w?0:0==w?C:C>0?C:T,this.xaxisOffset=_,x=A?e.max.apply(e,g)+e.max.apply(e,q):T-C,this.canvasHeightEf=w&&0>C?this.canvasHeight-2:this.canvasHeight-1,_>C?(O=A&&T>=0?$:T,L=(O-_)/x*this.canvasHeight,L!==e.ceil(L)&&(this.canvasHeightEf-=2,L=e.ceil(L))):L=this.canvasHeight,this.yoffset=L,n.isArray(o.get("colorMap"))?(this.colorMapByIndex=o.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=o.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===i&&(this.colorMapByValue=new y(this.colorMapByValue))),this.range=x},getRegion:function(t,n){var s=e.floor(n/this.totalBarWidth);return 0>s||s>=this.values.length?i:s},getCurrentRegionFields:function(){var t,e,i=this.currentRegion,n=m(this.values[i]),s=[];for(e=n.length;e--;)t=n[e],s.push({isNull:null===t,value:t,color:this.calcColor(e,t,i),offset:i});return s},calcColor:function(t,e,s){var o,r,a=this.colorMapByIndex,l=this.colorMapByValue,h=this.options;return o=this.stacked?h.get("stackedBarColor"):0>e?h.get("negBarColor"):h.get("barColor"),0===e&&h.get("zeroColor")!==i&&(o=h.get("zeroColor")),l&&(r=l.get(e))?o=r:a&&a.length>s&&(o=a[s]),n.isArray(o)?o[t%o.length]:o},renderRegion:function(t,s){var o,r,a,l,h,c,u,d,f,g,m=this.values[t],v=this.options,y=this.xaxisOffset,b=[],x=this.range,w=this.stacked,_=this.target,k=t*this.totalBarWidth,C=this.canvasHeightEf,T=this.yoffset;if(m=n.isArray(m)?m:[m],u=m.length,d=m[0],l=p(null,m),g=p(y,m,!0),l)return v.get("nullColor")?(a=s?v.get("nullColor"):this.calcHighlightColor(v.get("nullColor"),v),o=T>0?T-1:T,_.drawRect(k,o,this.barWidth-1,0,a,a)):i;for(h=T,c=0;u>c;c++){if(d=m[c],w&&d===y){if(!g||f)continue;f=!0}r=x>0?e.floor(C*(e.abs(d-y)/x))+1:1,y>d||d===y&&0===T?(o=h,h+=r):(o=T-r,T-=r),a=this.calcColor(c,d,t),s&&(a=this.calcHighlightColor(a,v)),b.push(_.drawRect(k,o,this.barWidth-1,r-1,a,a))}return 1===b.length?b[0]:b}}),n.fn.sparkline.tristate=C=o(n.fn.sparkline._base,w,{type:"tristate",init:function(t,e,s,o,r){var a=parseInt(s.get("barWidth"),10),l=parseInt(s.get("barSpacing"),10);C._super.init.call(this,t,e,s,o,r),this.regionShapes={},this.barWidth=a,this.barSpacing=l,this.totalBarWidth=a+l,this.values=n.map(e,Number),this.width=o=e.length*a+(e.length-1)*l,n.isArray(s.get("colorMap"))?(this.colorMapByIndex=s.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=s.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===i&&(this.colorMapByValue=new y(this.colorMapByValue))),this.initTarget()},getRegion:function(t,i){return e.floor(i/this.totalBarWidth)},getCurrentRegionFields:function(){var t=this.currentRegion;return{isNull:this.values[t]===i,value:this.values[t],color:this.calcColor(this.values[t],t),offset:t}},calcColor:function(t,e){var i,n,s=this.values,o=this.options,r=this.colorMapByIndex,a=this.colorMapByValue;return i=a&&(n=a.get(t))?n:r&&r.length>e?r[e]:s[e]<0?o.get("negBarColor"):s[e]>0?o.get("posBarColor"):o.get("zeroBarColor")},renderRegion:function(t,i){var n,s,o,r,a,l,h=this.values,c=this.options,u=this.target;return n=u.pixelHeight,o=e.round(n/2),r=t*this.totalBarWidth,h[t]<0?(a=o,s=o-1):h[t]>0?(a=0,s=o-1):(a=o-1,s=2),l=this.calcColor(h[t],t),null!==l?(i&&(l=this.calcHighlightColor(l,c)),u.drawRect(r,a,this.barWidth-1,s-1,l,l)):void 0}}),n.fn.sparkline.discrete=T=o(n.fn.sparkline._base,w,{type:"discrete",init:function(t,s,o,r,a){T._super.init.call(this,t,s,o,r,a),this.regionShapes={},this.values=s=n.map(s,Number),this.min=e.min.apply(e,s),this.max=e.max.apply(e,s),this.range=this.max-this.min,this.width=r="auto"===o.get("width")?2*s.length:this.width,this.interval=e.floor(r/s.length),this.itemWidth=r/s.length,o.get("chartRangeMin")!==i&&(o.get("chartRangeClip")||o.get("chartRangeMin")<this.min)&&(this.min=o.get("chartRangeMin")),o.get("chartRangeMax")!==i&&(o.get("chartRangeClip")||o.get("chartRangeMax")>this.max)&&(this.max=o.get("chartRangeMax")),this.initTarget(),this.target&&(this.lineHeight="auto"===o.get("lineHeight")?e.round(.3*this.canvasHeight):o.get("lineHeight"))},getRegion:function(t,i){return e.floor(i/this.itemWidth)},getCurrentRegionFields:function(){var t=this.currentRegion;return{isNull:this.values[t]===i,value:this.values[t],offset:t}},renderRegion:function(t,i){var n,s,o,r,l=this.values,h=this.options,c=this.min,u=this.max,d=this.range,p=this.interval,f=this.target,g=this.canvasHeight,m=this.lineHeight,v=g-m;return s=a(l[t],c,u),r=t*p,n=e.round(v-v*((s-c)/d)),o=h.get("thresholdColor")&&s<h.get("thresholdValue")?h.get("thresholdColor"):h.get("lineColor"),i&&(o=this.calcHighlightColor(o,h)),f.drawLine(r,n,r,n+m,o)}}),n.fn.sparkline.bullet=S=o(n.fn.sparkline._base,{type:"bullet",init:function(t,n,s,o,r){var a,l,h;S._super.init.call(this,t,n,s,o,r),this.values=n=c(n),h=n.slice(),h[0]=null===h[0]?h[2]:h[0],h[1]=null===n[1]?h[2]:h[1],a=e.min.apply(e,n),l=e.max.apply(e,n),a=s.get("base")===i?0>a?a:0:s.get("base"),this.min=a,this.max=l,this.range=l-a,this.shapes={},this.valueShapes={},this.regiondata={},this.width=o="auto"===s.get("width")?"4.0em":o,this.target=this.$el.simpledraw(o,r,s.get("composite")),n.length||(this.disabled=!0),this.initTarget()},getRegion:function(t,e,n){var s=this.target.getShapeAt(t,e,n);return s!==i&&this.shapes[s]!==i?this.shapes[s]:i},getCurrentRegionFields:function(){var t=this.currentRegion;return{fieldkey:t.substr(0,1),value:this.values[t.substr(1)],region:t}},changeHighlight:function(t){var e,i=this.currentRegion,n=this.valueShapes[i];switch(delete this.shapes[n],i.substr(0,1)){case"r":e=this.renderRange(i.substr(1),t);break;case"p":e=this.renderPerformance(t);break;case"t":e=this.renderTarget(t)}this.valueShapes[i]=e.id,this.shapes[e.id]=i,this.target.replaceWithShape(n,e)},renderRange:function(t,i){var n=this.values[t],s=e.round(this.canvasWidth*((n-this.min)/this.range)),o=this.options.get("rangeColors")[t-2];return i&&(o=this.calcHighlightColor(o,this.options)),this.target.drawRect(0,0,s-1,this.canvasHeight-1,o,o)},renderPerformance:function(t){var i=this.values[1],n=e.round(this.canvasWidth*((i-this.min)/this.range)),s=this.options.get("performanceColor");return t&&(s=this.calcHighlightColor(s,this.options)),this.target.drawRect(0,e.round(.3*this.canvasHeight),n-1,e.round(.4*this.canvasHeight)-1,s,s)},renderTarget:function(t){var i=this.values[0],n=e.round(this.canvasWidth*((i-this.min)/this.range)-this.options.get("targetWidth")/2),s=e.round(.1*this.canvasHeight),o=this.canvasHeight-2*s,r=this.options.get("targetColor");return t&&(r=this.calcHighlightColor(r,this.options)),this.target.drawRect(n,s,this.options.get("targetWidth")-1,o-1,r,r)},render:function(){var t,e,i=this.values.length,n=this.target;if(S._super.render.call(this)){for(t=2;i>t;t++)e=this.renderRange(t).append(),this.shapes[e.id]="r"+t,this.valueShapes["r"+t]=e.id;null!==this.values[1]&&(e=this.renderPerformance().append(),this.shapes[e.id]="p1",this.valueShapes.p1=e.id),null!==this.values[0]&&(e=this.renderTarget().append(),this.shapes[e.id]="t0",this.valueShapes.t0=e.id),n.render()}}}),n.fn.sparkline.pie=D=o(n.fn.sparkline._base,{type:"pie",init:function(t,i,s,o,r){var a,l=0;if(D._super.init.call(this,t,i,s,o,r),this.shapes={},this.valueShapes={},this.values=i=n.map(i,Number),"auto"===s.get("width")&&(this.width=this.height),i.length>0)for(a=i.length;a--;)l+=i[a];this.total=l,this.initTarget(),this.radius=e.floor(e.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(t,e,n){var s=this.target.getShapeAt(t,e,n);return s!==i&&this.shapes[s]!==i?this.shapes[s]:i},getCurrentRegionFields:function(){var t=this.currentRegion;return{isNull:this.values[t]===i,value:this.values[t],percent:this.values[t]/this.total*100,color:this.options.get("sliceColors")[t%this.options.get("sliceColors").length],offset:t}},changeHighlight:function(t){var e=this.currentRegion,i=this.renderSlice(e,t),n=this.valueShapes[e];delete this.shapes[n],this.target.replaceWithShape(n,i),this.valueShapes[e]=i.id,this.shapes[i.id]=e},renderSlice:function(t,n){var s,o,r,a,l,h=this.target,c=this.options,u=this.radius,d=c.get("borderWidth"),p=c.get("offset"),f=2*e.PI,g=this.values,m=this.total,v=p?2*e.PI*(p/360):0;for(a=g.length,r=0;a>r;r++){if(s=v,o=v,m>0&&(o=v+f*(g[r]/m)),t===r)return l=c.get("sliceColors")[r%c.get("sliceColors").length],n&&(l=this.calcHighlightColor(l,c)),h.drawPieSlice(u,u,u-d,s,o,i,l);v=o}},render:function(){var t,n,s=this.target,o=this.values,r=this.options,a=this.radius,l=r.get("borderWidth");if(D._super.render.call(this)){for(l&&s.drawCircle(a,a,e.floor(a-l/2),r.get("borderColor"),i,l).append(),n=o.length;n--;)o[n]&&(t=this.renderSlice(n).append(),this.valueShapes[n]=t.id,this.shapes[t.id]=n);s.render()}}}),n.fn.sparkline.box=A=o(n.fn.sparkline._base,{type:"box",init:function(t,e,i,s,o){A._super.init.call(this,t,e,i,s,o),this.values=n.map(e,Number),this.width="auto"===i.get("width")?"4.0em":s,this.initTarget(),this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var t=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];return this.loutlier!==i&&t.push({field:"lo",value:this.loutlier}),this.routlier!==i&&t.push({
field:"ro",value:this.routlier}),this.lwhisker!==i&&t.push({field:"lw",value:this.lwhisker}),this.rwhisker!==i&&t.push({field:"rw",value:this.rwhisker}),t},render:function(){var t,n,s,o,r,a,h,c,u,d,p,f=this.target,g=this.values,m=g.length,v=this.options,y=this.canvasWidth,b=this.canvasHeight,x=v.get("chartRangeMin")===i?e.min.apply(e,g):v.get("chartRangeMin"),w=v.get("chartRangeMax")===i?e.max.apply(e,g):v.get("chartRangeMax"),_=0;if(A._super.render.call(this)){if(v.get("raw"))v.get("showOutliers")&&g.length>5?(n=g[0],t=g[1],o=g[2],r=g[3],a=g[4],h=g[5],c=g[6]):(t=g[0],o=g[1],r=g[2],a=g[3],h=g[4]);else if(g.sort(function(t,e){return t-e}),o=l(g,1),r=l(g,2),a=l(g,3),s=a-o,v.get("showOutliers")){for(t=h=i,u=0;m>u;u++)t===i&&g[u]>o-s*v.get("outlierIQR")&&(t=g[u]),g[u]<a+s*v.get("outlierIQR")&&(h=g[u]);n=g[0],c=g[m-1]}else t=g[0],h=g[m-1];this.quartiles=[o,r,a],this.lwhisker=t,this.rwhisker=h,this.loutlier=n,this.routlier=c,p=y/(w-x+1),v.get("showOutliers")&&(_=e.ceil(v.get("spotRadius")),y-=2*e.ceil(v.get("spotRadius")),p=y/(w-x+1),t>n&&f.drawCircle((n-x)*p+_,b/2,v.get("spotRadius"),v.get("outlierLineColor"),v.get("outlierFillColor")).append(),c>h&&f.drawCircle((c-x)*p+_,b/2,v.get("spotRadius"),v.get("outlierLineColor"),v.get("outlierFillColor")).append()),f.drawRect(e.round((o-x)*p+_),e.round(.1*b),e.round((a-o)*p),e.round(.8*b),v.get("boxLineColor"),v.get("boxFillColor")).append(),f.drawLine(e.round((t-x)*p+_),e.round(b/2),e.round((o-x)*p+_),e.round(b/2),v.get("lineColor")).append(),f.drawLine(e.round((t-x)*p+_),e.round(b/4),e.round((t-x)*p+_),e.round(b-b/4),v.get("whiskerColor")).append(),f.drawLine(e.round((h-x)*p+_),e.round(b/2),e.round((a-x)*p+_),e.round(b/2),v.get("lineColor")).append(),f.drawLine(e.round((h-x)*p+_),e.round(b/4),e.round((h-x)*p+_),e.round(b-b/4),v.get("whiskerColor")).append(),f.drawLine(e.round((r-x)*p+_),e.round(.1*b),e.round((r-x)*p+_),e.round(.9*b),v.get("medianColor")).append(),v.get("target")&&(d=e.ceil(v.get("spotRadius")),f.drawLine(e.round((v.get("target")-x)*p+_),e.round(b/2-d),e.round((v.get("target")-x)*p+_),e.round(b/2+d),v.get("targetColor")).append(),f.drawLine(e.round((v.get("target")-x)*p+_-d),e.round(b/2),e.round((v.get("target")-x)*p+_+d),e.round(b/2),v.get("targetColor")).append()),f.render()}}}),P=o({init:function(t,e,i,n){this.target=t,this.id=e,this.type=i,this.args=n},append:function(){return this.target.appendShape(this),this}}),M=o({_pxregex:/(\d+)(px)?\s*$/i,init:function(t,e,i){t&&(this.width=t,this.height=e,this.target=i,this.lastShapeId=null,i[0]&&(i=i[0]),n.data(i,"_jqs_vcanvas",this))},drawLine:function(t,e,i,n,s,o){return this.drawShape([[t,e],[i,n]],s,o)},drawShape:function(t,e,i,n){return this._genShape("Shape",[t,e,i,n])},drawCircle:function(t,e,i,n,s,o){return this._genShape("Circle",[t,e,i,n,s,o])},drawPieSlice:function(t,e,i,n,s,o,r){return this._genShape("PieSlice",[t,e,i,n,s,o,r])},drawRect:function(t,e,i,n,s,o){return this._genShape("Rect",[t,e,i,n,s,o])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(t,e){n(e).html(t)},_calculatePixelDims:function(t,e,i){var s;s=this._pxregex.exec(e),s?this.pixelHeight=s[1]:this.pixelHeight=n(i).height(),s=this._pxregex.exec(t),s?this.pixelWidth=s[1]:this.pixelWidth=n(i).width()},_genShape:function(t,e){var i=R++;return e.unshift(i),new P(this,i,t,e)},appendShape:function(){alert("appendShape not implemented")},replaceWithShape:function(){alert("replaceWithShape not implemented")},insertAfterShape:function(){alert("insertAfterShape not implemented")},removeShapeId:function(){alert("removeShapeId not implemented")},getShapeAt:function(){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}}),N=o(M,{init:function(e,s,o,r){N._super.init.call(this,e,s,o),this.canvas=t.createElement("canvas"),o[0]&&(o=o[0]),n.data(o,"_jqs_vcanvas",this),n(this.canvas).css({display:"inline-block",width:e,height:s,verticalAlign:"top"}),this._insert(this.canvas,o),this._calculatePixelDims(e,s,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,this.interact=r,this.shapes={},this.shapeseq=[],this.currentTargetShapeId=i,n(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(t,e,n){var s=this.canvas.getContext("2d");return t!==i&&(s.strokeStyle=t),s.lineWidth=n===i?1:n,e!==i&&(s.fillStyle=e),s},reset:function(){var t=this._getContext();t.clearRect(0,0,this.pixelWidth,this.pixelHeight),this.shapes={},this.shapeseq=[],this.currentTargetShapeId=i},_drawShape:function(t,e,n,s,o){var r,a,l=this._getContext(n,s,o);for(l.beginPath(),l.moveTo(e[0][0]+.5,e[0][1]+.5),r=1,a=e.length;a>r;r++)l.lineTo(e[r][0]+.5,e[r][1]+.5);n!==i&&l.stroke(),s!==i&&l.fill(),this.targetX!==i&&this.targetY!==i&&l.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=t)},_drawCircle:function(t,n,s,o,r,a,l){var h=this._getContext(r,a,l);h.beginPath(),h.arc(n,s,o,0,2*e.PI,!1),this.targetX!==i&&this.targetY!==i&&h.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=t),r!==i&&h.stroke(),a!==i&&h.fill()},_drawPieSlice:function(t,e,n,s,o,r,a,l){var h=this._getContext(a,l);h.beginPath(),h.moveTo(e,n),h.arc(e,n,s,o,r,!1),h.lineTo(e,n),h.closePath(),a!==i&&h.stroke(),l&&h.fill(),this.targetX!==i&&this.targetY!==i&&h.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=t)},_drawRect:function(t,e,i,n,s,o,r){return this._drawShape(t,[[e,i],[e+n,i],[e+n,i+s],[e,i+s],[e,i]],o,r)},appendShape:function(t){return this.shapes[t.id]=t,this.shapeseq.push(t.id),this.lastShapeId=t.id,t.id},replaceWithShape:function(t,e){var i,n=this.shapeseq;for(this.shapes[e.id]=e,i=n.length;i--;)n[i]==t&&(n[i]=e.id);delete this.shapes[t]},replaceWithShapes:function(t,e){var i,n,s,o=this.shapeseq,r={};for(n=t.length;n--;)r[t[n]]=!0;for(n=o.length;n--;)i=o[n],r[i]&&(o.splice(n,1),delete this.shapes[i],s=n);for(n=e.length;n--;)o.splice(s,0,e[n].id),this.shapes[e[n].id]=e[n]},insertAfterShape:function(t,e){var i,n=this.shapeseq;for(i=n.length;i--;)if(n[i]===t)return n.splice(i+1,0,e.id),void(this.shapes[e.id]=e)},removeShapeId:function(t){var e,i=this.shapeseq;for(e=i.length;e--;)if(i[e]===t){i.splice(e,1);break}delete this.shapes[t]},getShapeAt:function(t,e,i){return this.targetX=e,this.targetY=i,this.render(),this.currentTargetShapeId},render:function(){var t,e,i,n=this.shapeseq,s=this.shapes,o=n.length,r=this._getContext();for(r.clearRect(0,0,this.pixelWidth,this.pixelHeight),i=0;o>i;i++)t=n[i],e=s[t],this["_draw"+e.type].apply(this,e.args);this.interact||(this.shapes={},this.shapeseq=[])}}),L=o(M,{init:function(e,i,s){var o;L._super.init.call(this,e,i,s),s[0]&&(s=s[0]),n.data(s,"_jqs_vcanvas",this),this.canvas=t.createElement("span"),n(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:e,height:i,margin:"0px",padding:"0px",verticalAlign:"top"}),this._insert(this.canvas,s),this._calculatePixelDims(e,i,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,o='<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" style="position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height="+this.pixelHeight+'px;"></v:group>',this.canvas.insertAdjacentHTML("beforeEnd",o),this.group=n(this.canvas).children()[0],this.rendered=!1,this.prerender=""},_drawShape:function(t,e,n,s,o){var r,a,l,h,c,u,d,p=[];for(d=0,u=e.length;u>d;d++)p[d]=""+e[d][0]+","+e[d][1];return r=p.splice(0,1),o=o===i?1:o,a=n===i?' stroked="false" ':' strokeWeight="'+o+'px" strokeColor="'+n+'" ',l=s===i?' filled="false"':' fillColor="'+s+'" filled="true" ',h=p[0]===p[p.length-1]?"x ":"",c='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+t+'" '+a+l+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+r+" l "+p.join(", ")+" "+h+'e"> </v:shape>'},_drawCircle:function(t,e,n,s,o,r,a){var l,h,c;return e-=s,n-=s,l=o===i?' stroked="false" ':' strokeWeight="'+a+'px" strokeColor="'+o+'" ',h=r===i?' filled="false"':' fillColor="'+r+'" filled="true" ',c='<v:oval  id="jqsshape'+t+'" '+l+h+' style="position:absolute;top:'+n+"px; left:"+e+"px; width:"+2*s+"px; height:"+2*s+'px"></v:oval>'},_drawPieSlice:function(t,n,s,o,r,a,l,h){var c,u,d,p,f,g,m,v;if(r===a)return"";if(a-r===2*e.PI&&(r=0,a=2*e.PI),u=n+e.round(e.cos(r)*o),d=s+e.round(e.sin(r)*o),p=n+e.round(e.cos(a)*o),f=s+e.round(e.sin(a)*o),u===p&&d===f){if(a-r<e.PI)return"";u=p=n+o,d=f=s}return u===p&&d===f&&a-r<e.PI?"":(c=[n-o,s-o,n+o,s+o,u,d,p,f],g=l===i?' stroked="false" ':' strokeWeight="1px" strokeColor="'+l+'" ',m=h===i?' filled="false"':' fillColor="'+h+'" filled="true" ',v='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+t+'" '+g+m+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+n+","+s+" wa "+c.join(", ")+' x e"> </v:shape>')},_drawRect:function(t,e,i,n,s,o,r){return this._drawShape(t,[[e,i],[e,i+s],[e+n,i+s],[e+n,i],[e,i]],o,r)},reset:function(){this.group.innerHTML=""},appendShape:function(t){var e=this["_draw"+t.type].apply(this,t.args);return this.rendered?this.group.insertAdjacentHTML("beforeEnd",e):this.prerender+=e,this.lastShapeId=t.id,t.id},replaceWithShape:function(t,e){var i=n("#jqsshape"+t),s=this["_draw"+e.type].apply(this,e.args);i[0].outerHTML=s},replaceWithShapes:function(t,e){var i,s=n("#jqsshape"+t[0]),o="",r=e.length;for(i=0;r>i;i++)o+=this["_draw"+e[i].type].apply(this,e[i].args);for(s[0].outerHTML=o,i=1;i<t.length;i++)n("#jqsshape"+t[i]).remove()},insertAfterShape:function(t,e){var i=n("#jqsshape"+t),s=this["_draw"+e.type].apply(this,e.args);i[0].insertAdjacentHTML("afterEnd",s)},removeShapeId:function(t){var e=n("#jqsshape"+t);this.group.removeChild(e[0])},getShapeAt:function(t){var e=t.id.substr(8);return e},render:function(){this.rendered||(this.group.innerHTML=this.prerender,this.rendered=!0)}})})}(document,Math);